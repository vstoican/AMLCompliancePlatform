<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AML Control Center</title>
  <link rel="stylesheet" href="./styles.css" />
  <link rel="icon" href="data:," />
</head>
<body>
  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <div class="app-shell">
    <aside class="sidebar">
      <div class="brand">
        <img src="./logo.jpeg" alt="TrustRelay" class="brand-logo" />
        <div>
          <div class="brand-title">TrustRelay</div>
          <div class="brand-sub">AML Ops Console</div>
        </div>
      </div>
      <nav class="nav accordion">
        <!-- Dashboard - Always visible at top -->
        <button class="nav-item active" data-target="overview" style="margin-bottom: 8px; font-weight: 600;">
          <span style="margin-right: 8px;">üìä</span> Dashboard
        </button>

        <div class="accordion-item open">
          <button class="accordion-trigger">Case Management</button>
          <div class="accordion-panel">
            <button class="nav-item" data-target="customers">Customers</button>
            <button class="nav-item" data-target="transactions">Transactions</button>
            <button class="nav-item" data-target="tasks">Tasks</button>
            <button class="nav-item" data-target="alert-stream">Alert Stream</button>
          </div>
        </div>

        <div class="accordion-item">
          <button class="accordion-trigger">Rules & Automation</button>
          <div class="accordion-panel">
            <button class="nav-item" data-target="alert-definitions">Alert Definitions</button>
            <button class="nav-item" data-target="workflow-definitions">Workflows</button>
            <button class="nav-item" data-target="workflow-executions">Workflow History</button>
          </div>
        </div>

        <div class="accordion-item">
          <button class="accordion-trigger">Analytics</button>
          <div class="accordion-panel">
            <button class="nav-item" data-target="risk-analysis">Risk Analysis</button>
            <button class="nav-item" data-target="country-distribution">Country Distribution</button>
            <button class="nav-item" data-target="transactions-alerts">Transaction Trends</button>
            <button class="nav-item" data-target="reports">Compliance Reports</button>
          </div>
        </div>

        <div class="accordion-item">
          <button class="accordion-trigger">Administration</button>
          <div class="accordion-panel">
            <button class="nav-item" data-target="users">Users</button>
            <button class="nav-item" data-target="roles">Roles & Permissions</button>
            <button class="nav-item" data-target="audit-log">Audit Log</button>
          </div>
        </div>

      </nav>
      <div class="nav-footer" style="flex-direction: column; gap: 4px;">
        <button class="nav-item" data-target="ai-assistant" style="width: 100%; display: flex; align-items: center; gap: 8px; justify-content: flex-start; padding: 10px 12px;">
          <img src="ai-assistant-logo.png" alt="AI" style="width: 24px; height: 24px; border-radius: 50%; object-fit: cover;">
          <span>AI Assistant</span>
        </button>
        <div style="display: flex; width: 100%;">
          <button class="btn ghost" id="settingsBtn" style="flex: 1; display: flex; align-items: center; gap: 8px; justify-content: flex-start;">
            <span style="font-size: 18px;">‚öôÔ∏è</span>
            <span>Settings</span>
          </button>
          <button id="themeToggle" class="btn ghost" aria-label="Switch theme" style="padding: 10px;">
            <span id="themeIcon" class="icon"></span>
          </button>
        </div>
      </div>
    </aside>

    <main class="main">

      <section id="overview" class="panel active">
        <div class="grid stats">
          <div class="card">
            <p class="label">Open Alerts</p>
            <p id="statAlerts" class="metric">-</p>
            <span class="badge red">Case load</span>
          </div>
          <div class="card">
            <p class="label">High-Risk Customers</p>
            <p id="statHighRisk" class="metric">-</p>
            <span class="badge amber">Risk</span>
          </div>
          <div class="card">
            <p class="label">Past 24h Volume</p>
            <p id="statVolume" class="metric">-</p>
            <span class="badge purple">Transactions</span>
          </div>
        </div>
        <div class="grid two overview-lists">
          <div class="card">
            <div class="card-head">
              <h3>Recent Alerts</h3>
              <button class="btn text" data-target="alert-stream">View all</button>
            </div>
            <div id="recentAlerts" class="list"></div>
          </div>
          <div class="card">
            <div class="card-head">
              <h3>Recent Transactions</h3>
              <button class="btn text" data-target="transactions">View all</button>
            </div>
            <div id="recentTransactions" class="list"></div>
          </div>
        </div>
      </section>

      <!-- AI ASSISTANT SECTION -->
      <section id="ai-assistant" class="panel">
        <div class="panel-head">
          <div>
            <h2>AI Assistant</h2>
            <p class="muted">Ask questions about your compliance data using natural language</p>
          </div>
          <div style="display: flex; gap: 8px; align-items: center;">
            <span id="aiModelBadge" class="badge muted">Not configured</span>
            <button id="aiSettingsBtn" class="btn ghost" onclick="openAISettings()">Configure</button>
          </div>
        </div>

        <div class="ai-chat-container" style="display: flex; flex-direction: column; height: calc(100vh - 200px); max-height: 800px;">
          <!-- Chat Messages Area -->
          <div id="aiChatMessages" class="ai-chat-messages" style="flex: 1; overflow-y: auto; padding: 16px; background: var(--bg-muted); border-radius: 8px; margin-bottom: 16px;">
            <div class="ai-welcome-message" style="text-align: center; padding: 40px 20px; color: var(--text-muted);">
              <img src="ai-assistant-logo.png" alt="AI Assistant" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 16px;">
              <h3 style="margin: 0 0 8px 0; color: var(--text);">Welcome to AI Assistant</h3>
              <p style="margin: 0 0 24px 0;">I can help you analyze your AML compliance data. Ask me questions like:</p>
              <div style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;">
                <button class="ai-suggestion-chip" onclick="askAISuggestion('How many high-risk customers do we have?')">How many high-risk customers?</button>
                <button class="ai-suggestion-chip" onclick="askAISuggestion('Show me alerts from the last 7 days')">Recent alerts</button>
                <button class="ai-suggestion-chip" onclick="askAISuggestion('What are the top transaction patterns?')">Transaction patterns</button>
                <button class="ai-suggestion-chip" onclick="askAISuggestion('List pending tasks by priority')">Pending tasks</button>
              </div>
            </div>
          </div>

          <!-- Chat Input Area -->
          <div class="ai-chat-input-container" style="display: flex; gap: 12px; align-items: flex-end;">
            <div style="flex: 1; position: relative;">
              <textarea
                id="aiChatInput"
                placeholder="Ask a question about your compliance data..."
                style="width: 100%; min-height: 50px; max-height: 150px; resize: vertical; padding: 12px; padding-right: 50px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); font-family: inherit; font-size: 14px;"
                onkeydown="handleAIChatKeydown(event)"
              ></textarea>
            </div>
            <button id="aiSendBtn" class="btn primary" onclick="sendAIMessage()" style="height: 50px; padding: 0 24px;">
              Send
            </button>
          </div>

          <!-- Status indicator -->
          <div id="aiStatusIndicator" class="ai-status" style="margin-top: 8px; font-size: 12px; color: var(--text-muted); display: none;">
            <span class="ai-typing-indicator">AI is thinking...</span>
          </div>
        </div>
      </section>

      <section id="customers" class="panel">
        <div class="panel-head">
          <div>
            <h2>Customers</h2>
            <p class="muted">Risk overview, overrides, and identity freshness</p>
          </div>
          <button id="createCustomerBtn" class="btn primary">New Customer</button>
        </div>
        <!-- Contextual Search & Filters -->
        <div class="panel-filters" style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; align-items: center;">
          <input id="customerSearch" type="search" placeholder="Search by name, member ID, phone, email..." style="flex: 1; min-width: 200px;" />
          <select id="customerStatusFilter">
            <option value="">All Statuses</option>
            <option value="PENDING">Pending</option>
            <option value="ACTIVE">Active</option>
            <option value="SUSPENDED">Suspended</option>
            <option value="CLOSED">Closed</option>
          </select>
          <select id="customerRiskFilter">
            <option value="">All Risk Levels</option>
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
          </select>
          <select id="customerValidationFilter">
            <option value="">All Validation</option>
            <option value="VALIDATED">Validated</option>
            <option value="NOT VALIDATED">Not Validated</option>
            <option value="PENDING">Pending</option>
          </select>
        </div>
        <div id="customerTable" class="table"></div>
      </section>

      <section id="transactions" class="panel">
        <div class="panel-head">
          <div>
            <h2>Transactions</h2>
            <p class="muted">Real-time transactions with settlement tracking</p>
          </div>
        </div>

        <!-- Transaction Stats -->
        <div class="grid stats" style="margin-bottom: 20px;">
          <div class="card">
            <p class="label">Total Transactions</p>
            <p id="txnTotalCount" class="metric">-</p>
            <span class="badge purple">All Time</span>
          </div>
          <div class="card">
            <p class="label">Pending Financial</p>
            <p id="txnPendingFinancial" class="metric">-</p>
            <span class="badge amber">Awaiting</span>
          </div>
          <div class="card">
            <p class="label">Unpaid (Client)</p>
            <p id="txnUnpaidClient" class="metric">-</p>
            <span class="badge amber">Settlement</span>
          </div>
          <div class="card">
            <p class="label">Total Volume</p>
            <p id="txnTotalVolume" class="metric">-</p>
            <span class="badge teal">EUR</span>
          </div>
        </div>

        <!-- Contextual Search & Filters -->
        <div class="panel-filters" style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; align-items: center;">
          <input id="transactionSearch" type="search" placeholder="Search by ID, person name, vendor..." style="flex: 1; min-width: 200px;" />
          <select id="transactionFinancialFilter">
            <option value="">All Financial Status</option>
            <option value="PENDING">Pending</option>
            <option value="COMPLETED">Completed</option>
            <option value="FAILED">Failed</option>
          </select>
          <select id="transactionSettlementFilter">
            <option value="">All Settlements</option>
            <option value="paid">Paid</option>
            <option value="unpaid">Unpaid</option>
          </select>
          <select id="transactionDeliveryFilter">
            <option value="">All Delivery</option>
            <option value="PENDING">Pending</option>
            <option value="DELIVERED">Delivered</option>
          </select>
        </div>

        <div id="transactionTable" class="table"></div>
      </section>

      <section id="alert-definitions" class="panel">
        <div class="panel-head">
          <div>
            <h2>Alert definitions</h2>
            <p class="muted">Toggle to enable/disable alert rules</p>
          </div>
          <button id="createAlertDefBtn" class="btn primary">New Alert Rule</button>
        </div>
        <div class="card">
          <div id="alertDefinitions2" class="list dense"></div>
        </div>
      </section>

      <section id="alert-stream" class="panel">
        <div class="panel-head">
          <div>
            <h2>Recent Alerts</h2>
            <p class="muted">Monitor and manage triggered alerts</p>
          </div>
        </div>

        <!-- Alert Stats -->
        <div class="grid stats" style="margin-bottom: 20px;">
          <div class="card">
            <p class="label">Open Alerts</p>
            <p id="alertOpenCount" class="metric">-</p>
            <span class="badge amber">New</span>
          </div>
          <div class="card">
            <p class="label">Assigned</p>
            <p id="alertAssignedCount" class="metric">-</p>
            <span class="badge blue">Working</span>
          </div>
          <div class="card">
            <p class="label">Escalated</p>
            <p id="alertEscalatedCount" class="metric">-</p>
            <span class="badge red">Urgent</span>
          </div>
          <div class="card">
            <p class="label">Resolved Today</p>
            <p id="alertResolvedTodayCount" class="metric">-</p>
            <span class="badge teal">Done</span>
          </div>
        </div>

        <!-- Alert Filters -->
        <div class="panel-filters" style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; align-items: center;">
          <input id="alertStreamSearch" type="search" placeholder="Search alerts..." style="flex: 1; min-width: 200px;" />
          <select id="alertStatusFilter2">
            <option value="">All Statuses</option>
            <option value="open">Open</option>
            <option value="assigned">Assigned</option>
            <option value="in_progress">In Progress</option>
            <option value="escalated">Escalated</option>
            <option value="on_hold">On Hold</option>
            <option value="resolved">Resolved</option>
          </select>
          <select id="alertSeverityFilter2">
            <option value="">All Severities</option>
            <option value="critical">Critical</option>
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
          </select>
          <select id="alertAssignedFilter">
            <option value="">All Assignments</option>
            <option value="unassigned">Unassigned</option>
            <option value="me">Assigned to Me</option>
          </select>
        </div>

        <div id="alertTable2" class="table"></div>
      </section>

      <!-- TASKS SECTION -->
      <section id="tasks" class="panel">
        <div class="panel-head">
          <div>
            <h2>Task Queue</h2>
            <p class="muted">Shared compliance task queue - claim and work tasks</p>
          </div>
          <button id="createTaskBtn" class="btn primary">New Task</button>
        </div>

        <!-- Task Stats -->
        <div class="grid stats" style="margin-bottom: 20px;">
          <div class="card">
            <p class="label">Pending Tasks</p>
            <p id="taskPendingCount" class="metric">-</p>
            <span class="badge amber">Unclaimed</span>
          </div>
          <div class="card">
            <p class="label">In Progress</p>
            <p id="taskInProgressCount" class="metric">-</p>
            <span class="badge teal">Working</span>
          </div>
          <div class="card">
            <p class="label">Critical Priority</p>
            <p id="taskCriticalCount" class="metric">-</p>
            <span class="badge red">Urgent</span>
          </div>
          <div class="card">
            <p class="label">Due Today</p>
            <p id="taskDueTodayCount" class="metric">-</p>
            <span class="badge purple">Deadline</span>
          </div>
        </div>

        <!-- Task Filters -->
        <div class="panel-filters" style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; align-items: center;">
          <input id="taskSearch" type="search" placeholder="Search tasks..." style="flex: 1; min-width: 200px;" />
          <select id="taskStatusFilter">
            <option value="">All Status</option>
            <option value="pending">Pending</option>
            <option value="in_progress">In Progress</option>
            <option value="completed">Completed</option>
          </select>
          <select id="taskTypeFilter">
            <option value="">All Types</option>
            <option value="investigation">Investigation</option>
            <option value="kyc_refresh">KYC Refresh</option>
            <option value="document_request">Document Request</option>
            <option value="escalation">Escalation</option>
            <option value="sar_filing">SAR Filing</option>
          </select>
          <select id="taskPriorityFilter">
            <option value="">All Priorities</option>
            <option value="critical">Critical</option>
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
          </select>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="taskUnclaimedOnly" />
            <span>Unclaimed only</span>
          </label>
        </div>

        <!-- Task List -->
        <div id="taskList" class="task-list"></div>
      </section>

      <!-- Task Detail Modal -->
      <div id="taskDetailModal" class="modal hidden">
        <div class="modal-content" style="max-width: 700px;">
          <div class="modal-head">
            <h3 id="taskDetailTitle">Task Details</h3>
            <button id="closeTaskDetailModal" class="btn ghost">X</button>
          </div>
          <div id="taskDetailContent"></div>
          <div id="taskDetailActions" class="modal-actions" style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 20px;"></div>
        </div>
      </div>

      <!-- Task Create Modal -->
      <div id="taskModal" class="modal hidden">
        <div class="modal-content" style="max-width: 600px;">
          <div class="modal-head">
            <h3 id="taskModalTitle">Create New Task</h3>
            <button id="closeTaskModal" class="btn ghost">X</button>
          </div>
          <form id="taskForm">
            <div class="form-group">
              <label>Task Type</label>
              <select name="task_type" required>
                <option value="investigation">Investigation</option>
                <option value="kyc_refresh">KYC Refresh</option>
                <option value="document_request">Document Request</option>
                <option value="escalation">Escalation</option>
                <option value="sar_filing">SAR Filing</option>
              </select>
            </div>
            <div class="form-group">
              <label>Customer (Optional)</label>
              <select name="customer_id" id="taskCustomerSelect">
                <option value="">Select customer...</option>
              </select>
            </div>
            <div class="form-group">
              <label>Related Alert (Optional)</label>
              <select name="alert_id" id="taskAlertSelect">
                <option value="">Select alert...</option>
              </select>
            </div>
            <div class="form-group">
              <label>Title</label>
              <input type="text" name="title" required placeholder="Task title" />
            </div>
            <div class="form-group">
              <label>Description</label>
              <textarea name="description" rows="3" placeholder="Task description"></textarea>
            </div>
            <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
              <div class="form-group">
                <label>Priority</label>
                <select name="priority">
                  <option value="medium">Medium</option>
                  <option value="low">Low</option>
                  <option value="high">High</option>
                  <option value="critical">Critical</option>
                </select>
              </div>
              <div class="form-group">
                <label>Due Date</label>
                <input type="datetime-local" name="due_date" />
              </div>
            </div>
            <div class="form-actions" style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 20px;">
              <button type="button" class="btn ghost" onclick="toggleTaskModal(false)">Cancel</button>
              <button type="submit" class="btn primary">Create Task</button>
            </div>
          </form>
        </div>
      </div>

      <section id="workflow-definitions" class="panel">
        <div class="panel-head">
          <div>
            <h2>Workflow Definitions</h2>
            <p class="muted">Automated compliance workflows powered by Temporal</p>
          </div>
          <a href="http://localhost:8080" target="_blank" class="btn ghost">
            Open Temporal UI
          </a>
        </div>

        <!-- Workflow Stats Summary -->
        <div class="grid stats" style="margin-bottom: 20px;">
          <div class="card">
            <p class="label">Available Workflows</p>
            <p class="metric">2</p>
            <span class="badge teal">Active</span>
          </div>
          <div class="card">
            <p class="label">Total Executions</p>
            <p id="wfTotalExecutions" class="metric">-</p>
            <span class="badge purple">All time</span>
          </div>
          <div class="card">
            <p class="label">Success Rate</p>
            <p id="wfSuccessRate" class="metric">-</p>
            <span class="badge teal">Completed</span>
          </div>
          <div class="card">
            <p class="label">Currently Running</p>
            <p id="wfRunningCount" class="metric">-</p>
            <span class="badge amber">In progress</span>
          </div>
        </div>

        <div class="grid two">
          <!-- KYC Expiration Check Workflow -->
          <div class="card workflow-card">
            <div style="display: flex; align-items: flex-start; gap: 16px; margin-bottom: 16px;">
              <div style="width: 56px; height: 56px; border-radius: 12px; background: linear-gradient(135deg, rgba(91,224,179,0.2), rgba(91,224,179,0.05)); display: flex; align-items: center; justify-content: center; font-size: 28px; flex-shrink: 0;">
                üìã
              </div>
              <div style="flex: 1;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 4px;">
                  <h3 style="margin: 0; font-size: 18px;">KYC Expiration Check</h3>
                  <span class="badge teal" style="font-size: 10px;">ACTIVE</span>
                </div>
                <p class="muted" style="margin: 0; font-size: 13px; line-height: 1.5;">
                  Automatically monitors customer document expiration and creates KYC renewal tasks before documents expire.
                </p>
              </div>
            </div>

            <div style="background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 14px; margin-bottom: 16px;">
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; text-align: center;">
                <div>
                  <div style="font-size: 20px; font-weight: 700; color: var(--text);" id="kycWfCompleted">-</div>
                  <div style="font-size: 11px; color: var(--muted); text-transform: uppercase;">Completed</div>
                </div>
                <div>
                  <div style="font-size: 20px; font-weight: 700; color: var(--amber);" id="kycWfRunning">-</div>
                  <div style="font-size: 11px; color: var(--muted); text-transform: uppercase;">Running</div>
                </div>
                <div>
                  <div style="font-size: 20px; font-weight: 700; color: var(--primary);">365d</div>
                  <div style="font-size: 11px; color: var(--muted); text-transform: uppercase;">Check Window</div>
                </div>
              </div>
            </div>

            <div style="display: grid; gap: 8px; font-size: 13px; margin-bottom: 16px;">
              <div style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: rgba(255,255,255,0.02); border-radius: 6px;">
                <span style="color: var(--primary);">‚Ä¢</span>
                <span>Checks documents expiring within <strong>1 year</strong></span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: rgba(255,255,255,0.02); border-radius: 6px;">
                <span style="color: var(--primary);">‚Ä¢</span>
                <span>Creates KYC task for compliance team review</span>
              </div>
            </div>

            <button class="btn primary" onclick="openWorkflowModal('kyc-refresh')" style="width: 100%;">
              Run KYC Check
            </button>
          </div>

          <!-- Sanctions Screening Workflow -->
          <div class="card workflow-card">
            <div style="display: flex; align-items: flex-start; gap: 16px; margin-bottom: 16px;">
              <div style="width: 56px; height: 56px; border-radius: 12px; background: linear-gradient(135deg, rgba(239,68,68,0.2), rgba(239,68,68,0.05)); display: flex; align-items: center; justify-content: center; font-size: 28px; flex-shrink: 0;">
                üõ°Ô∏è
              </div>
              <div style="flex: 1;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 4px;">
                  <h3 style="margin: 0; font-size: 18px;">Sanctions Screening</h3>
                  <span class="badge teal" style="font-size: 10px;">ACTIVE</span>
                </div>
                <p class="muted" style="margin: 0; font-size: 13px; line-height: 1.5;">
                  Screens customers against sanctions lists and creates high-priority alerts when matches are detected.
                </p>
              </div>
            </div>

            <div style="background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 14px; margin-bottom: 16px;">
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; text-align: center;">
                <div>
                  <div style="font-size: 20px; font-weight: 700; color: var(--text);" id="sanctionsWfCompleted">-</div>
                  <div style="font-size: 11px; color: var(--muted); text-transform: uppercase;">Completed</div>
                </div>
                <div>
                  <div style="font-size: 20px; font-weight: 700; color: var(--amber);" id="sanctionsWfRunning">-</div>
                  <div style="font-size: 11px; color: var(--muted); text-transform: uppercase;">Running</div>
                </div>
                <div>
                  <div style="font-size: 20px; font-weight: 700; color: var(--red);" id="sanctionsWfAlerts">-</div>
                  <div style="font-size: 11px; color: var(--muted); text-transform: uppercase;">Alerts Created</div>
                </div>
              </div>
            </div>

            <div style="display: grid; gap: 8px; font-size: 13px; margin-bottom: 16px;">
              <div style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: rgba(255,255,255,0.02); border-radius: 6px;">
                <span style="color: var(--red);">‚Ä¢</span>
                <span>Checks against global sanctions databases</span>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: rgba(255,255,255,0.02); border-radius: 6px;">
                <span style="color: var(--red);">‚Ä¢</span>
                <span>Creates <strong>high severity</strong> alert on match</span>
              </div>
            </div>

            <button class="btn primary" onclick="openWorkflowModal('sanctions-screening')" style="width: 100%;">
              Run Sanctions Check
            </button>
          </div>
        </div>

        <!-- How it works -->
        <div class="card" style="margin-top: 20px;">
          <h3 style="margin: 0 0 16px 0; font-size: 16px;">How Temporal Workflows Work</h3>
          <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
            <div style="text-align: center;">
              <div style="width: 48px; height: 48px; margin: 0 auto 12px; border-radius: 50%; background: rgba(91,224,179,0.1); display: flex; align-items: center; justify-content: center; font-size: 20px;">1</div>
              <div style="font-size: 13px; font-weight: 600; margin-bottom: 4px;">Trigger</div>
              <div style="font-size: 12px; color: var(--muted);">Start workflow manually or via automation</div>
            </div>
            <div style="text-align: center;">
              <div style="width: 48px; height: 48px; margin: 0 auto 12px; border-radius: 50%; background: rgba(91,224,179,0.1); display: flex; align-items: center; justify-content: center; font-size: 20px;">2</div>
              <div style="font-size: 13px; font-weight: 600; margin-bottom: 4px;">Execute</div>
              <div style="font-size: 12px; color: var(--muted);">Workflow runs activities in sequence</div>
            </div>
            <div style="text-align: center;">
              <div style="width: 48px; height: 48px; margin: 0 auto 12px; border-radius: 50%; background: rgba(91,224,179,0.1); display: flex; align-items: center; justify-content: center; font-size: 20px;">3</div>
              <div style="font-size: 13px; font-weight: 600; margin-bottom: 4px;">Recover</div>
              <div style="font-size: 12px; color: var(--muted);">Auto-retry on failure with backoff</div>
            </div>
            <div style="text-align: center;">
              <div style="width: 48px; height: 48px; margin: 0 auto 12px; border-radius: 50%; background: rgba(91,224,179,0.1); display: flex; align-items: center; justify-content: center; font-size: 20px;">4</div>
              <div style="font-size: 13px; font-weight: 600; margin-bottom: 4px;">Complete</div>
              <div style="font-size: 12px; color: var(--muted);">Results stored for audit trail</div>
            </div>
          </div>
        </div>
      </section>

      <section id="workflow-executions" class="panel">
        <div class="panel-head">
          <div>
            <h2>Workflow History</h2>
            <p class="muted">Monitor running and completed workflow instances</p>
          </div>
          <div class="inline">
            <select id="workflowStatusFilter">
              <option value="">All Statuses</option>
              <option value="RUNNING">Running</option>
              <option value="COMPLETED">Completed</option>
              <option value="FAILED">Failed</option>
              <option value="CANCELED">Canceled</option>
            </select>
            <select id="workflowTypeFilter">
              <option value="">All Types</option>
              <option value="KycRefreshWorkflow">KYC Expiration Check</option>
              <option value="SanctionsScreeningWorkflow">Sanctions Screening</option>
            </select>
            <button id="refreshWorkflowsBtn" class="btn primary">Refresh</button>
          </div>
        </div>

        <!-- Execution Stats -->
        <div class="grid stats" style="margin-bottom: 20px;">
          <div class="card">
            <p class="label">Completed</p>
            <p id="execCompleted" class="metric" style="color: var(--primary);">-</p>
            <span class="badge teal">Success</span>
          </div>
          <div class="card">
            <p class="label">Running</p>
            <p id="execRunning" class="metric" style="color: var(--amber);">-</p>
            <span class="badge amber">In Progress</span>
          </div>
          <div class="card">
            <p class="label">Failed</p>
            <p id="execFailed" class="metric" style="color: var(--red);">-</p>
            <span class="badge red">Error</span>
          </div>
          <div class="card">
            <p class="label">Avg Duration</p>
            <p id="execAvgDuration" class="metric">-</p>
            <span class="badge purple">Performance</span>
          </div>
        </div>

        <div class="card" style="padding: 0; overflow: hidden;">
          <div id="workflowsListView" class="workflows-list">
            <!-- Populated by JS -->
            <div style="padding: 40px; text-align: center; color: var(--muted);">
              Loading workflow executions...
            </div>
          </div>
        </div>

        <div id="workflowDetailsPanel" class="card" style="margin-top: 20px; display: none;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h3 style="margin: 0;">Execution Details</h3>
            <button class="btn ghost" onclick="closeWorkflowDetails()" style="padding: 6px 12px;">Close</button>
          </div>
          <div id="workflowDetailsContent"></div>
        </div>
      </section>

      <section id="reports" class="panel">
        <div class="panel-head">
          <div>
            <h2>Compliance Reports</h2>
            <p class="muted">High-risk roster, alert history, and regulatory reports</p>
          </div>
          <div class="inline">
            <input id="reportFrom" type="date" />
            <input id="reportTo" type="date" />
            <button id="runReportBtn" class="btn ghost">Run</button>
          </div>
        </div>
        <div class="grid two">
          <div class="card">
            <div class="card-head">
              <h3>High-Risk Customers</h3>
            </div>
            <div id="reportHighRisk" class="list"></div>
          </div>
          <div class="card">
            <div class="card-head">
              <h3>Alerts (filtered)</h3>
            </div>
            <div id="reportAlerts" class="list"></div>
          </div>
        </div>
      </section>

      <section id="webhooks" class="panel">
        <div class="panel-head">
          <div>
            <h2>Webhooks</h2>
            <p class="muted">Configure webhook endpoints for event notifications</p>
          </div>
          <button class="btn primary">New Webhook</button>
        </div>
        <div class="card">
          <div class="list dense">
            <div class="row">
              <div>
                <div class="title">Customer Risk Events</div>
                <div class="subtitle">https://example.com/webhooks/customer-risk</div>
                <div class="chips">
                  <span class="chip">aml.customer.created</span>
                  <span class="chip">aml.customer.risk</span>
                </div>
              </div>
              <div class="row-actions">
                <span class="badge teal">Active</span>
                <label class="switch">
                  <input type="checkbox" checked />
                  <span></span>
                </label>
              </div>
            </div>
            <div class="row">
              <div>
                <div class="title">Transaction Monitoring</div>
                <div class="subtitle">https://example.com/webhooks/transactions</div>
                <div class="chips">
                  <span class="chip">aml.transaction.ingested</span>
                </div>
              </div>
              <div class="row-actions">
                <span class="badge teal">Active</span>
                <label class="switch">
                  <input type="checkbox" checked />
                  <span></span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="api-keys" class="panel">
        <div class="panel-head">
          <div>
            <h2>API Keys</h2>
            <p class="muted">Manage API keys for external integrations</p>
          </div>
          <button class="btn primary">Generate Key</button>
        </div>
        <div class="card">
          <div class="list dense">
            <div class="row">
              <div>
                <div class="title">Production API Key</div>
                <div class="subtitle">Created: 2024-11-15 ¬∑ Last used: 2 hours ago</div>
                <div class="chips">
                  <span class="chip">read:customers</span>
                  <span class="chip">write:transactions</span>
                  <span class="chip">read:alerts</span>
                </div>
              </div>
              <div class="row-actions">
                <button class="btn ghost">Revoke</button>
              </div>
            </div>
            <div class="row">
              <div>
                <div class="title">Development API Key</div>
                <div class="subtitle">Created: 2024-10-01 ¬∑ Last used: 1 day ago</div>
                <div class="chips">
                  <span class="chip">read:*</span>
                </div>
              </div>
              <div class="row-actions">
                <button class="btn ghost">Revoke</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="data-exports" class="panel">
        <div class="panel-head">
          <div>
            <h2>Data Exports</h2>
            <p class="muted">Export compliance data and reports</p>
          </div>
          <button class="btn primary">New Export</button>
        </div>
        <div class="grid two">
          <div class="card">
            <div class="card-head">
              <h3>Export Templates</h3>
            </div>
            <div class="list">
              <div class="row">
                <div>
                  <div class="title">Customer Risk Report</div>
                  <div class="subtitle">All customers with risk scores and flags</div>
                </div>
                <button class="btn outline">Export CSV</button>
              </div>
              <div class="row">
                <div>
                  <div class="title">Alert History</div>
                  <div class="subtitle">All alerts with resolution details</div>
                </div>
                <button class="btn outline">Export CSV</button>
              </div>
              <div class="row">
                <div>
                  <div class="title">Transaction Log</div>
                  <div class="subtitle">Full transaction history with metadata</div>
                </div>
                <button class="btn outline">Export CSV</button>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-head">
              <h3>Recent Exports</h3>
            </div>
            <div class="list">
              <div class="row">
                <div>
                  <div class="title">customer-risk-2024-11-28.csv</div>
                  <div class="subtitle">Generated: Nov 28, 2024 at 3:42 PM</div>
                </div>
                <button class="btn text">Download</button>
              </div>
              <div class="row">
                <div>
                  <div class="title">alerts-q4-2024.csv</div>
                  <div class="subtitle">Generated: Nov 22, 2024 at 10:15 AM</div>
                </div>
                <button class="btn text">Download</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="country-distribution" class="panel">
        <div class="panel-head">
          <div>
            <h2>Customer Distribution by Country</h2>
            <p class="muted">Geographic distribution and risk analysis</p>
          </div>
          <div class="inline">
            <input type="date" id="countryReportFrom" />
            <input type="date" id="countryReportTo" />
            <button class="btn ghost">Export CSV</button>
          </div>
        </div>
        <div class="grid two">
          <div class="card">
            <div class="card-head">
              <h3>Top Countries</h3>
              <span class="muted small">Total customers: <span id="totalCustomers">-</span></span>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Country</th>
                  <th>Customers</th>
                  <th>Percentage</th>
                  <th>High Risk</th>
                  <th>Avg Risk Score</th>
                </tr>
              </thead>
              <tbody id="countryDistributionTable">
                <tr>
                  <td>üá∑üá¥ Romania</td>
                  <td>245</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 100px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 45%; height: 100%; background: var(--primary);"></div>
                      </div>
                      <span>45%</span>
                    </div>
                  </td>
                  <td><span class="badge red">12</span></td>
                  <td>4.2</td>
                </tr>
                <tr>
                  <td>üá©üá™ Germany</td>
                  <td>158</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 100px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 29%; height: 100%; background: var(--primary);"></div>
                      </div>
                      <span>29%</span>
                    </div>
                  </td>
                  <td><span class="badge amber">5</span></td>
                  <td>3.1</td>
                </tr>
                <tr>
                  <td>üá´üá∑ France</td>
                  <td>87</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 100px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 16%; height: 100%; background: var(--primary);"></div>
                      </div>
                      <span>16%</span>
                    </div>
                  </td>
                  <td><span class="badge teal">2</span></td>
                  <td>2.8</td>
                </tr>
                <tr>
                  <td>üá¨üáß United Kingdom</td>
                  <td>34</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 100px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 6%; height: 100%; background: var(--primary);"></div>
                      </div>
                      <span>6%</span>
                    </div>
                  </td>
                  <td><span class="badge teal">1</span></td>
                  <td>2.5</td>
                </tr>
                <tr>
                  <td>üáÆüáπ Italy</td>
                  <td>21</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 100px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 4%; height: 100%; background: var(--primary);"></div>
                      </div>
                      <span>4%</span>
                    </div>
                  </td>
                  <td><span class="badge teal">0</span></td>
                  <td>2.3</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-head">
              <h3>Risk Distribution by Country</h3>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Country</th>
                  <th>Low</th>
                  <th>Medium</th>
                  <th>High</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>üá∑üá¥ Romania</td>
                  <td><span class="badge teal">180</span></td>
                  <td><span class="badge amber">53</span></td>
                  <td><span class="badge red">12</span></td>
                </tr>
                <tr>
                  <td>üá©üá™ Germany</td>
                  <td><span class="badge teal">125</span></td>
                  <td><span class="badge amber">28</span></td>
                  <td><span class="badge red">5</span></td>
                </tr>
                <tr>
                  <td>üá´üá∑ France</td>
                  <td><span class="badge teal">70</span></td>
                  <td><span class="badge amber">15</span></td>
                  <td><span class="badge red">2</span></td>
                </tr>
                <tr>
                  <td>üá¨üáß United Kingdom</td>
                  <td><span class="badge teal">28</span></td>
                  <td><span class="badge amber">5</span></td>
                  <td><span class="badge red">1</span></td>
                </tr>
                <tr>
                  <td>üáÆüáπ Italy</td>
                  <td><span class="badge teal">18</span></td>
                  <td><span class="badge amber">3</span></td>
                  <td><span class="badge red">0</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="transactions-alerts" class="panel">
        <div class="panel-head">
          <div>
            <h2>Transaction Trends</h2>
            <p class="muted">Transaction volume, alert rates, and pattern analysis</p>
          </div>
          <div class="inline">
            <select id="transactionsAlertsTimeframe">
              <option value="7">Last 7 days</option>
              <option value="30" selected>Last 30 days</option>
              <option value="90">Last 90 days</option>
            </select>
            <button class="btn ghost">Export CSV</button>
          </div>
        </div>
        <div class="grid stats">
          <div class="card">
            <p class="label">Total Transactions</p>
            <p id="totalTransactions" class="metric">-</p>
            <span class="badge purple">Volume</span>
          </div>
          <div class="card">
            <p class="label">Total Alerts</p>
            <p id="totalAlerts" class="metric">-</p>
            <span class="badge red">Triggered</span>
          </div>
          <div class="card">
            <p class="label">Alert Rate</p>
            <p id="alertRate" class="metric">-</p>
            <span class="badge amber">Percentage</span>
          </div>
          <div class="card">
            <p class="label">Avg Daily Transactions</p>
            <p id="avgDailyTransactions" class="metric">-</p>
            <span class="badge teal">Per Day</span>
          </div>
        </div>
        <div class="grid two" style="margin-top: 18px;">
          <div class="card">
            <div class="card-head">
              <h3>Daily Trend</h3>
              <span class="muted small">Last 30 days</span>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Transactions</th>
                  <th>Alerts</th>
                  <th>Alert Rate</th>
                </tr>
              </thead>
              <tbody id="dailyTrendTable">
                <tr>
                  <td>2024-12-01</td>
                  <td>342</td>
                  <td>18</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 60px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 5.3%; height: 100%; background: var(--red);"></div>
                      </div>
                      <span>5.3%</span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td>2024-11-30</td>
                  <td>298</td>
                  <td>12</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 60px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 4%; height: 100%; background: var(--amber);"></div>
                      </div>
                      <span>4.0%</span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td>2024-11-29</td>
                  <td>412</td>
                  <td>25</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 60px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 6%; height: 100%; background: var(--red);"></div>
                      </div>
                      <span>6.1%</span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td>2024-11-28</td>
                  <td>385</td>
                  <td>15</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 60px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 3.9%; height: 100%; background: var(--amber);"></div>
                      </div>
                      <span>3.9%</span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td>2024-11-27</td>
                  <td>276</td>
                  <td>8</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 60px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 2.9%; height: 100%; background: var(--teal);"></div>
                      </div>
                      <span>2.9%</span>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-head">
              <h3>Alert Breakdown by Definition</h3>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Alert Type</th>
                  <th>Count</th>
                  <th>% of Total</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Cash ‚â• EUR 10k</td>
                  <td>28</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 80px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 36%; height: 100%; background: var(--red);"></div>
                      </div>
                      <span>36%</span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td>Velocity ‚â• EUR 5k in 1h</td>
                  <td>22</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 80px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 28%; height: 100%; background: var(--amber);"></div>
                      </div>
                      <span>28%</span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td>External transfer ‚â• EUR 10k</td>
                  <td>15</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 80px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 19%; height: 100%; background: var(--amber);"></div>
                      </div>
                      <span>19%</span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td>Large transaction ‚â• EUR 50k</td>
                  <td>8</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 80px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 10%; height: 100%; background: var(--teal);"></div>
                      </div>
                      <span>10%</span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td>High-risk customer ‚â• EUR 1k</td>
                  <td>5</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 80px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 6%; height: 100%; background: var(--teal);"></div>
                      </div>
                      <span>6%</span>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="risk-analysis" class="panel">
        <div class="panel-head">
          <div>
            <h2>Risk Analysis</h2>
            <p class="muted">Customer risk distribution and trends</p>
          </div>
          <button class="btn ghost">Export CSV</button>
        </div>
        <div class="grid stats">
          <div class="card">
            <p class="label">High Risk Customers</p>
            <p id="highRiskCount" class="metric">-</p>
            <span class="badge red">Critical</span>
          </div>
          <div class="card">
            <p class="label">Medium Risk Customers</p>
            <p id="mediumRiskCount" class="metric">-</p>
            <span class="badge amber">Monitor</span>
          </div>
          <div class="card">
            <p class="label">Low Risk Customers</p>
            <p id="lowRiskCount" class="metric">-</p>
            <span class="badge teal">Normal</span>
          </div>
          <div class="card">
            <p class="label">Avg Risk Score</p>
            <p id="avgRiskScore" class="metric">-</p>
            <span class="badge purple">Overall</span>
          </div>
        </div>
        <div class="grid two" style="margin-top: 18px;">
          <div class="card">
            <div class="card-head">
              <h3>Risk Level Distribution</h3>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Risk Level</th>
                  <th>Count</th>
                  <th>Percentage</th>
                  <th>Trend</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><span class="badge red">High</span></td>
                  <td>20</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 100px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 4%; height: 100%; background: var(--red);"></div>
                      </div>
                      <span>4%</span>
                    </div>
                  </td>
                  <td style="color: var(--red);">‚Üë +2</td>
                </tr>
                <tr>
                  <td><span class="badge amber">Medium</span></td>
                  <td>104</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 100px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 19%; height: 100%; background: var(--amber);"></div>
                      </div>
                      <span>19%</span>
                    </div>
                  </td>
                  <td style="color: var(--amber);">‚Üë +5</td>
                </tr>
                <tr>
                  <td><span class="badge teal">Low</span></td>
                  <td>421</td>
                  <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="width: 100px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="width: 77%; height: 100%; background: var(--teal);"></div>
                      </div>
                      <span>77%</span>
                    </div>
                  </td>
                  <td style="color: var(--teal);">‚Üì -7</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="card">
            <div class="card-head">
              <h3>Top Risk Indicators</h3>
            </div>
            <div class="list">
              <div class="row">
                <div>
                  <div class="title">PEP Flag</div>
                  <div class="subtitle">Politically Exposed Persons</div>
                </div>
                <span class="badge red">12 customers</span>
              </div>
              <div class="row">
                <div>
                  <div class="title">Sanctions Hit</div>
                  <div class="subtitle">Sanctions screening matches</div>
                </div>
                <span class="badge red">3 customers</span>
              </div>
              <div class="row">
                <div>
                  <div class="title">High Geography Risk</div>
                  <div class="subtitle">High-risk jurisdictions</div>
                </div>
                <span class="badge amber">28 customers</span>
              </div>
              <div class="row">
                <div>
                  <div class="title">High Product Risk</div>
                  <div class="subtitle">Complex product usage</div>
                </div>
                <span class="badge amber">45 customers</span>
              </div>
              <div class="row">
                <div>
                  <div class="title">High Behavior Risk</div>
                  <div class="subtitle">Unusual transaction patterns</div>
                </div>
                <span class="badge amber">62 customers</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="users" class="panel">
        <div class="panel-head">
          <div>
            <h2>Users</h2>
            <p class="muted">Manage system users and access controls</p>
          </div>
          <button class="btn primary">New User</button>
        </div>
        <div class="card">
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
                <th>Last Login</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Alexandru Popescu</td>
                <td>alex.popescu@trustrelay.com</td>
                <td><span class="badge purple">Admin</span></td>
                <td><span class="badge teal">Active</span></td>
                <td>2024-12-01 14:32</td>
                <td>
                  <div style="display: flex; gap: 6px;">
                    <button class="btn ghost" style="padding: 6px 10px; font-size: 13px;">Edit</button>
                    <button class="btn ghost" style="padding: 6px 10px; font-size: 13px;">Disable</button>
                  </div>
                </td>
              </tr>
              <tr>
                <td>Maria Ionescu</td>
                <td>maria.ionescu@trustrelay.com</td>
                <td><span class="badge teal">Analyst</span></td>
                <td><span class="badge teal">Active</span></td>
                <td>2024-12-01 10:15</td>
                <td>
                  <div style="display: flex; gap: 6px;">
                    <button class="btn ghost" style="padding: 6px 10px; font-size: 13px;">Edit</button>
                    <button class="btn ghost" style="padding: 6px 10px; font-size: 13px;">Disable</button>
                  </div>
                </td>
              </tr>
              <tr>
                <td>Andrei Stoica</td>
                <td>andrei.stoica@trustrelay.com</td>
                <td><span class="badge amber">Manager</span></td>
                <td><span class="badge teal">Active</span></td>
                <td>2024-11-30 18:45</td>
                <td>
                  <div style="display: flex; gap: 6px;">
                    <button class="btn ghost" style="padding: 6px 10px; font-size: 13px;">Edit</button>
                    <button class="btn ghost" style="padding: 6px 10px; font-size: 13px;">Disable</button>
                  </div>
                </td>
              </tr>
              <tr>
                <td>Elena Dumitrescu</td>
                <td>elena.dumitrescu@trustrelay.com</td>
                <td><span class="badge teal">Analyst</span></td>
                <td><span class="badge red">Disabled</span></td>
                <td>2024-11-15 09:22</td>
                <td>
                  <div style="display: flex; gap: 6px;">
                    <button class="btn ghost" style="padding: 6px 10px; font-size: 13px;">Edit</button>
                    <button class="btn ghost" style="padding: 6px 10px; font-size: 13px; color: var(--primary);">Enable</button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section id="roles" class="panel">
        <div class="panel-head">
          <div>
            <h2>Roles & Permissions</h2>
            <p class="muted">Configure role-based access controls</p>
          </div>
          <button class="btn primary">New Role</button>
        </div>
        <div class="grid two">
          <div class="card">
            <div class="card-head">
              <h3>System Roles</h3>
            </div>
            <div class="list">
              <div class="row">
                <div>
                  <div class="title">Administrator</div>
                  <div class="subtitle">Full system access and configuration</div>
                  <div class="chips">
                    <span class="chip">read:*</span>
                    <span class="chip">write:*</span>
                    <span class="chip">admin:*</span>
                  </div>
                </div>
                <div class="row-actions">
                  <span class="badge purple">3 users</span>
                  <button class="btn ghost">Edit</button>
                </div>
              </div>
              <div class="row">
                <div>
                  <div class="title">Compliance Manager</div>
                  <div class="subtitle">Manage alerts, customers, and reports</div>
                  <div class="chips">
                    <span class="chip">read:customers</span>
                    <span class="chip">write:alerts</span>
                    <span class="chip">read:reports</span>
                  </div>
                </div>
                <div class="row-actions">
                  <span class="badge amber">5 users</span>
                  <button class="btn ghost">Edit</button>
                </div>
              </div>
              <div class="row">
                <div>
                  <div class="title">AML Analyst</div>
                  <div class="subtitle">Review alerts and customer profiles</div>
                  <div class="chips">
                    <span class="chip">read:customers</span>
                    <span class="chip">read:alerts</span>
                    <span class="chip">write:alerts</span>
                  </div>
                </div>
                <div class="row-actions">
                  <span class="badge teal">12 users</span>
                  <button class="btn ghost">Edit</button>
                </div>
              </div>
              <div class="row">
                <div>
                  <div class="title">Read-Only Auditor</div>
                  <div class="subtitle">View-only access for compliance audits</div>
                  <div class="chips">
                    <span class="chip">read:customers</span>
                    <span class="chip">read:alerts</span>
                    <span class="chip">read:reports</span>
                  </div>
                </div>
                <div class="row-actions">
                  <span class="badge teal">2 users</span>
                  <button class="btn ghost">Edit</button>
                </div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-head">
              <h3>Permission Matrix</h3>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Resource</th>
                  <th>Admin</th>
                  <th>Manager</th>
                  <th>Analyst</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Customers</td>
                  <td><span class="badge teal">Full</span></td>
                  <td><span class="badge teal">Full</span></td>
                  <td><span class="badge amber">Read</span></td>
                </tr>
                <tr>
                  <td>Alerts</td>
                  <td><span class="badge teal">Full</span></td>
                  <td><span class="badge teal">Full</span></td>
                  <td><span class="badge teal">Full</span></td>
                </tr>
                <tr>
                  <td>Transactions</td>
                  <td><span class="badge teal">Full</span></td>
                  <td><span class="badge amber">Read</span></td>
                  <td><span class="badge amber">Read</span></td>
                </tr>
                <tr>
                  <td>Reports</td>
                  <td><span class="badge teal">Full</span></td>
                  <td><span class="badge teal">Full</span></td>
                  <td><span class="badge amber">Read</span></td>
                </tr>
                <tr>
                  <td>User Management</td>
                  <td><span class="badge teal">Full</span></td>
                  <td><span class="badge red">None</span></td>
                  <td><span class="badge red">None</span></td>
                </tr>
                <tr>
                  <td>Integrations</td>
                  <td><span class="badge teal">Full</span></td>
                  <td><span class="badge amber">Read</span></td>
                  <td><span class="badge red">None</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="audit-log" class="panel">
        <div class="panel-head">
          <div>
            <h2>Audit Log</h2>
            <p class="muted">System activity and user action history</p>
          </div>
          <div class="inline">
            <select>
              <option value="">All Actions</option>
              <option value="create">Create</option>
              <option value="update">Update</option>
              <option value="delete">Delete</option>
              <option value="login">Login</option>
            </select>
            <select>
              <option value="">All Users</option>
              <option value="alex">Alexandru Popescu</option>
              <option value="maria">Maria Ionescu</option>
              <option value="andrei">Andrei Stoica</option>
            </select>
          </div>
        </div>
        <div class="card">
          <table>
            <thead>
              <tr>
                <th>Timestamp</th>
                <th>User</th>
                <th>Action</th>
                <th>Resource</th>
                <th>Details</th>
                <th>IP Address</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>2024-12-01 14:32:15</td>
                <td>Alexandru Popescu</td>
                <td><span class="badge teal">Update</span></td>
                <td>Customer</td>
                <td>Updated risk level for John Doe</td>
                <td>192.168.1.45</td>
              </tr>
              <tr>
                <td>2024-12-01 13:18:42</td>
                <td>Maria Ionescu</td>
                <td><span class="badge amber">Close</span></td>
                <td>Alert</td>
                <td>Closed alert #12345 (false positive)</td>
                <td>192.168.1.78</td>
              </tr>
              <tr>
                <td>2024-12-01 12:05:33</td>
                <td>Andrei Stoica</td>
                <td><span class="badge purple">Create</span></td>
                <td>Customer</td>
                <td>Created new customer: Jane Smith</td>
                <td>192.168.1.92</td>
              </tr>
              <tr>
                <td>2024-12-01 10:15:20</td>
                <td>Maria Ionescu</td>
                <td><span class="badge teal">Login</span></td>
                <td>Authentication</td>
                <td>Successful login</td>
                <td>192.168.1.78</td>
              </tr>
              <tr>
                <td>2024-12-01 09:45:12</td>
                <td>Alexandru Popescu</td>
                <td><span class="badge purple">Create</span></td>
                <td>Alert Definition</td>
                <td>Created new alert rule: VELOCITY_CHECK_2H</td>
                <td>192.168.1.45</td>
              </tr>
              <tr>
                <td>2024-12-01 09:22:05</td>
                <td>Alexandru Popescu</td>
                <td><span class="badge teal">Login</span></td>
                <td>Authentication</td>
                <td>Successful login</td>
                <td>192.168.1.45</td>
              </tr>
              <tr>
                <td>2024-11-30 18:45:33</td>
                <td>Andrei Stoica</td>
                <td><span class="badge red">Delete</span></td>
                <td>API Key</td>
                <td>Revoked API key: dev_key_123</td>
                <td>192.168.1.92</td>
              </tr>
              <tr>
                <td>2024-11-30 17:30:18</td>
                <td>Maria Ionescu</td>
                <td><span class="badge amber">Update</span></td>
                <td>Alert</td>
                <td>Updated status to in_progress for alert #12344</td>
                <td>192.168.1.78</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section id="settings" class="panel">
        <div class="panel-head">
          <div>
            <h2>Settings</h2>
            <p class="muted">Configure platform settings and risk parameters</p>
          </div>
        </div>

        <div class="card" style="padding: 0; overflow: hidden;">
          <div class="settings-tabs">
            <button class="settings-tab active" data-tab="company-info">Company Information</button>
            <button class="settings-tab" data-tab="risk-matrix">Risk Matrix</button>
            <button class="settings-tab" data-tab="geography-risk">Geography Risk</button>
            <button class="settings-tab" data-tab="ai-settings">AI Assistant</button>
            <button class="settings-tab" data-tab="integrations">Integrations</button>
          </div>

          <div class="settings-content">
            <!-- Company Information Tab -->
            <div id="company-info" class="settings-tab-content active">
              <form id="companyForm" class="form" style="padding: 24px;">
                <h3 style="margin-top: 0;">Company Details</h3>

                <label>
                  Company Name
                  <input name="company_name" type="text" placeholder="e.g., TrustRelay Financial Services" />
                </label>

                <label>
                  Registration Number
                  <input name="registration_number" type="text" placeholder="e.g., 12345678" />
                </label>

                <label>
                  Address
                  <input name="address_line1" type="text" placeholder="Street address" />
                </label>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                  <label>
                    City
                    <input name="city" type="text" placeholder="City" />
                  </label>
                  <label>
                    Postal Code
                    <input name="postal_code" type="text" placeholder="Postal code" />
                  </label>
                </div>

                <label>
                  Country
                  <input name="country" type="text" placeholder="Country" />
                </label>

                <h3 style="margin-top: 24px;">Contact Information</h3>

                <label>
                  Email
                  <input name="contact_email" type="email" placeholder="contact@example.com" />
                </label>

                <label>
                  Phone
                  <input name="contact_phone" type="tel" placeholder="+1 234 567 8900" />
                </label>

                <label>
                  Website
                  <input name="website" type="url" placeholder="https://example.com" />
                </label>

                <h3 style="margin-top: 24px;">Compliance Officer</h3>

                <label>
                  Name
                  <input name="compliance_officer_name" type="text" placeholder="Full name" />
                </label>

                <label>
                  Email
                  <input name="compliance_officer_email" type="email" placeholder="compliance@example.com" />
                </label>

                <label>
                  Phone
                  <input name="compliance_officer_phone" type="tel" placeholder="+1 234 567 8900" />
                </label>

                <button type="submit" class="btn primary" style="margin-top: 16px;">Save Company Information</button>
              </form>
            </div>

            <!-- Risk Matrix Tab -->
            <div id="risk-matrix" class="settings-tab-content">
              <form id="riskMatrixForm" class="form" style="padding: 24px;">
                <h3 style="margin-top: 0;">Risk Calculation Weights</h3>
                <p class="muted" style="margin-bottom: 20px;">
                  Configure the weights used in risk score calculation. Total weight should equal 80% (remainder is for penalty flags).
                </p>

                <div style="background: rgba(91,224,179,0.08); border: 1px solid var(--border); border-radius: 10px; padding: 16px; margin-bottom: 20px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <span style="font-weight: 600;">Current Formula:</span>
                    <span id="formulaPreview" style="font-family: monospace; font-size: 13px; color: var(--primary);">
                      (geo √ó 30 + prod √ó 20 + behav √ó 30) / 8
                    </span>
                  </div>
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: 600;">Total Weight:</span>
                    <span id="totalWeight" style="font-size: 18px; font-weight: 700; color: var(--primary);">80%</span>
                  </div>
                </div>

                <label>
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                    <span>Geography Risk Weight (%)</span>
                    <span class="badge teal" style="font-size: 11px;">Current: 30%</span>
                  </div>
                  <input name="geography_weight" type="number" min="0" max="100" step="1" value="30" />
                </label>

                <label>
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                    <span>Product Risk Weight (%)</span>
                    <span class="badge teal" style="font-size: 11px;">Current: 20%</span>
                  </div>
                  <input name="product_weight" type="number" min="0" max="100" step="1" value="20" />
                </label>

                <label>
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                    <span>Behavior Risk Weight (%)</span>
                    <span class="badge teal" style="font-size: 11px;">Current: 30%</span>
                  </div>
                  <input name="behavior_weight" type="number" min="0" max="100" step="1" value="30" />
                </label>

                <h3 style="margin-top: 24px;">Penalty Points</h3>
                <p class="muted" style="margin-bottom: 20px;">
                  Points added to the risk score when flags are triggered.
                </p>

                <label>
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                    <span>PEP Flag Penalty</span>
                    <span class="badge amber" style="font-size: 11px;">Current: +10</span>
                  </div>
                  <input name="pep_penalty" type="number" min="0" max="50" step="1" value="10" />
                </label>

                <label>
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                    <span>Sanctions Hit Penalty</span>
                    <span class="badge red" style="font-size: 11px;">Current: +15</span>
                  </div>
                  <input name="sanctions_penalty" type="number" min="0" max="50" step="1" value="15" />
                </label>

                <label>
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                    <span>Adverse Media Penalty</span>
                    <span class="badge purple" style="font-size: 11px;">Current: +5</span>
                  </div>
                  <input name="adverse_media_penalty" type="number" min="0" max="50" step="1" value="5" />
                </label>

                <h3 style="margin-top: 24px;">Risk Level Thresholds</h3>
                <p class="muted" style="margin-bottom: 20px;">
                  Define score thresholds for risk level classification (1-100 scale).
                </p>

                <label>
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                    <span>High Risk Threshold</span>
                    <span class="badge red" style="font-size: 11px;">‚â• 70</span>
                  </div>
                  <input name="high_threshold" type="number" min="1" max="100" step="1" value="70" />
                </label>

                <label>
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                    <span>Medium Risk Threshold</span>
                    <span class="badge amber" style="font-size: 11px;">‚â• 40</span>
                  </div>
                  <input name="medium_threshold" type="number" min="1" max="100" step="1" value="40" />
                </label>

                <p class="muted" style="margin-top: 8px; font-size: 12px;">
                  Scores below the medium threshold are classified as "low" risk.
                </p>

                <div style="display: flex; gap: 10px; margin-top: 24px;">
                  <button type="submit" class="btn primary">Save Risk Matrix</button>
                  <button type="button" id="resetRiskMatrix" class="btn outline">Reset to Defaults</button>
                </div>
              </form>
            </div>

            <!-- Geography Risk Tab -->
            <div id="geography-risk" class="settings-tab-content">
              <div style="padding: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                  <div>
                    <h3 style="margin: 0;">Country Risk Scores</h3>
                    <p class="muted" style="margin: 4px 0 0 0;">Assign risk scores (1-10) to countries for geographic risk assessment</p>
                  </div>
                  <button id="addCountryBtn" class="btn primary">Add Country</button>
                </div>

                <div style="margin-bottom: 16px;">
                  <input id="countrySearchInput" type="search" placeholder="Search countries..." style="width: 100%; max-width: 300px;" />
                </div>

                <div class="country-risk-table">
                  <!-- Table populated by JavaScript -->
                </div>
              </div>
            </div>

            <!-- AI Assistant Settings Tab -->
            <div id="ai-settings" class="settings-tab-content">
              <form id="aiSettingsForm" class="form" style="padding: 24px;">
                <h3 style="margin-top: 0;">AI Assistant Configuration</h3>
                <p class="muted" style="margin-bottom: 24px;">Configure the AI model and API credentials for the assistant</p>

                <div style="display: grid; gap: 20px; max-width: 600px;">
                  <!-- Provider Selection -->
                  <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">AI Provider</label>
                    <select id="aiProvider" name="ai_provider" style="width: 100%;">
                      <option value="anthropic">Anthropic (Claude)</option>
                      <option value="openai">OpenAI (GPT)</option>
                    </select>
                    <p class="muted" style="font-size: 12px; margin-top: 4px;">Select your AI provider</p>
                  </div>

                  <!-- Model Selection -->
                  <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">Model</label>
                    <select id="aiModel" name="ai_model" style="width: 100%;">
                      <optgroup label="Anthropic Models">
                        <option value="claude-sonnet-4-20250514">Claude Sonnet 4 (Recommended)</option>
                        <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                        <option value="claude-3-5-haiku-20241022">Claude 3.5 Haiku (Fast)</option>
                      </optgroup>
                      <optgroup label="OpenAI Models">
                        <option value="gpt-4o">GPT-4o</option>
                        <option value="gpt-4o-mini">GPT-4o Mini (Fast)</option>
                        <option value="gpt-4-turbo">GPT-4 Turbo</option>
                      </optgroup>
                    </select>
                    <p class="muted" style="font-size: 12px; margin-top: 4px;">Select the AI model to use for analysis</p>
                  </div>

                  <!-- API Key -->
                  <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">API Key</label>
                    <div style="display: flex; gap: 8px;">
                      <input
                        type="password"
                        id="aiApiKey"
                        name="ai_api_key"
                        placeholder="Enter your API key..."
                        style="flex: 1;"
                        autocomplete="off"
                      />
                      <button type="button" class="btn ghost" onclick="toggleApiKeyVisibility()">
                        <span id="apiKeyToggleIcon">Show</span>
                      </button>
                    </div>
                    <p class="muted" style="font-size: 12px; margin-top: 4px;">Your API key is stored securely and never shared</p>
                  </div>

                  <!-- Database Access Info -->
                  <div style="background: var(--bg-muted); padding: 16px; border-radius: 8px; border-left: 4px solid var(--teal);">
                    <h4 style="margin: 0 0 8px 0; display: flex; align-items: center; gap: 8px;">
                      <span>üóÑÔ∏è</span> Database Access
                    </h4>
                    <p class="muted" style="margin: 0; font-size: 13px;">
                      The AI Assistant has read-only access to your compliance database via MCP (Model Context Protocol).
                      It can query customers, transactions, alerts, and tasks to answer your questions.
                    </p>
                  </div>

                  <!-- Test Connection -->
                  <div style="display: flex; gap: 12px; align-items: center;">
                    <button type="button" class="btn ghost" onclick="testAIConnection()">Test Connection</button>
                    <span id="aiConnectionStatus" style="font-size: 13px;"></span>
                  </div>
                </div>

                <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);">
                  <button type="submit" class="btn primary">Save AI Settings</button>
                </div>
              </form>
            </div>

            <!-- Integrations Tab -->
            <div id="integrations" class="settings-tab-content">
              <div style="padding: 24px;">
                <h3 style="margin-top: 0;">External Integrations</h3>
                <p class="muted" style="margin-bottom: 24px;">Connect external services and manage data flows</p>

                <div class="grid three" style="gap: 16px;">
                  <div class="card settings-card" data-target="webhooks" style="cursor: pointer;">
                    <div style="font-size: 24px; margin-bottom: 8px;">üîó</div>
                    <h4>Webhooks</h4>
                    <p class="muted" style="font-size: 13px;">Configure webhook endpoints for event notifications</p>
                  </div>
                  <div class="card settings-card" data-target="api-keys" style="cursor: pointer;">
                    <div style="font-size: 24px; margin-bottom: 8px;">üîë</div>
                    <h4>API Keys</h4>
                    <p class="muted" style="font-size: 13px;">Manage API keys for external integrations</p>
                  </div>
                  <div class="card settings-card" data-target="data-exports" style="cursor: pointer;">
                    <div style="font-size: 24px; margin-bottom: 8px;">üì§</div>
                    <h4>Data Exports</h4>
                    <p class="muted" style="font-size: 13px;">Export data for compliance and reporting</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div id="modal" class="modal hidden">
    <div class="modal-content" style="width: min(700px, 95vw); max-height: 90vh; overflow-y: auto;">
      <div class="modal-head">
        <h3 id="modalTitle">Create Customer</h3>
        <button id="closeModal" class="btn icon">&times;</button>
      </div>
      <form id="customerForm" class="form">
        <!-- Basic Info Section -->
        <div style="margin-bottom: 16px; padding: 12px; background: rgba(91,224,179,0.05); border: 1px solid var(--border); border-radius: 10px;">
          <div style="margin-bottom: 12px; font-size: 13px; color: var(--primary); font-weight: 600;">Basic Information</div>
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 12px;">
            <label>Member ID <input name="member_id" placeholder="e.g. 161390" /></label>
            <label>Status <select name="status">
              <option value="PENDING">Pending</option>
              <option value="ACTIVE">Active</option>
              <option value="SUSPENDED">Suspended</option>
              <option value="CLOSED">Closed</option>
            </select></label>
          </div>
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 12px;">
            <label>First Name <input name="first_name" required placeholder="e.g. John" /></label>
            <label>Last Name <input name="last_name" required placeholder="e.g. Doe" /></label>
          </div>
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 12px;">
            <label>Phone Number <input name="phone_number" type="tel" placeholder="e.g. 40766259918" /></label>
            <label>Email <input name="email" type="email" placeholder="e.g. john@example.com" /></label>
          </div>
        </div>

        <!-- Personal Details Section -->
        <div style="margin-bottom: 16px; padding: 12px; background: rgba(91,224,179,0.05); border: 1px solid var(--border); border-radius: 10px;">
          <div style="margin-bottom: 12px; font-size: 13px; color: var(--primary); font-weight: 600;">Personal Details</div>
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 12px;">
            <label>Birth Date <input name="birth_date" type="date" /></label>
            <label>Identity Number (CNP) <input name="identity_number" placeholder="e.g. 2781119436018" /></label>
          </div>
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 12px;">
            <label>Place of Birth <input name="place_of_birth" placeholder="e.g. Bucuresti, Sector 3" /></label>
            <label>Country of Birth <input name="country_of_birth" placeholder="e.g. ROMANIA" /></label>
          </div>
          <label>Employer Name <input name="employer_name" placeholder="e.g. Company SRL" /></label>
        </div>

        <!-- Address Section -->
        <div style="margin-bottom: 16px; padding: 12px; background: rgba(91,224,179,0.05); border: 1px solid var(--border); border-radius: 10px;">
          <div style="margin-bottom: 12px; font-size: 13px; color: var(--primary); font-weight: 600;">Address</div>
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 12px;">
            <label>County <input name="address_county" placeholder="e.g. Bucuresti, Sector 3" /></label>
            <label>City <input name="address_city" placeholder="e.g. Bucuresti" /></label>
          </div>
          <div class="grid" style="grid-template-columns: 2fr 1fr; gap: 12px;">
            <label>Street <input name="address_street" placeholder="e.g. Patulului" /></label>
            <label>House No. <input name="address_house_number" placeholder="e.g. 4" /></label>
          </div>
          <div class="grid" style="grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
            <label>Block <input name="address_block_number" placeholder="e.g. v9" /></label>
            <label>Entrance <input name="address_entrance" placeholder="e.g. c" /></label>
            <label>Apartment <input name="address_apartment" placeholder="e.g. 165" /></label>
          </div>
        </div>

        <!-- Document Info Section -->
        <div style="margin-bottom: 16px; padding: 12px; background: rgba(91,224,179,0.05); border: 1px solid var(--border); border-radius: 10px;">
          <div style="margin-bottom: 12px; font-size: 13px; color: var(--primary); font-weight: 600;">Document Information</div>
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 12px;">
            <label>Document Type <select name="document_type">
              <option value="">Select...</option>
              <option value="PERSONAL_ID">Personal ID</option>
              <option value="PASSPORT">Passport</option>
              <option value="DRIVING_LICENSE">Driving License</option>
            </select></label>
            <label>Document ID <input name="document_id" placeholder="e.g. RD836425" /></label>
          </div>
          <label>Document Issuer <input name="document_issuer" placeholder="e.g. Authorised authority in Romania" /></label>
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 12px;">
            <label>Issue Date <input name="document_date_of_issue" type="date" /></label>
            <label>Expiry Date <input name="document_date_of_expire" type="date" /></label>
          </div>
        </div>

        <!-- Financial/Credit Section -->
        <div style="margin-bottom: 16px; padding: 12px; background: rgba(91,224,179,0.05); border: 1px solid var(--border); border-radius: 10px;">
          <div style="margin-bottom: 12px; font-size: 13px; color: var(--primary); font-weight: 600;">Financial Information</div>
          <div class="grid" style="grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
            <label>Monthly Repayment <input name="leanpay_monthly_repayment" type="number" step="0.01" value="0" /></label>
            <label>Credit Limit <input name="available_monthly_credit_limit" type="number" step="0.01" value="0" /></label>
            <label>Available Exposure <input name="available_exposure" type="number" step="0.01" value="0" /></label>
          </div>
        </div>

        <!-- Validation & Consent Section -->
        <div style="margin-bottom: 16px; padding: 12px; background: rgba(91,224,179,0.05); border: 1px solid var(--border); border-radius: 10px;">
          <div style="margin-bottom: 12px; font-size: 13px; color: var(--primary); font-weight: 600;">Validation & Consent</div>
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 12px;">
            <label>Data Validated <select name="data_validated">
              <option value="NOT VALIDATED">Not Validated</option>
              <option value="VALIDATED">Validated</option>
              <option value="PENDING">Pending</option>
            </select></label>
            <label>Marketing Consent <select name="marketing_consent">
              <option value="NOT SET">Not Set</option>
              <option value="ACCEPTED">Accepted</option>
              <option value="REJECTED">Rejected</option>
            </select></label>
          </div>
          <label class="checkbox" style="margin-top: 8px;">
            <input name="kyc_motion_consent_given" type="checkbox" />
            <span>KYC Motion Consent Given</span>
          </label>
        </div>

        <!-- Risk Indicators Section -->
        <div style="margin-bottom: 16px; padding: 12px; background: rgba(91,224,179,0.08); border: 1px solid var(--border); border-radius: 10px;">
          <div style="margin-bottom: 8px; font-size: 13px; color: var(--primary); font-weight: 600;">Risk Indicators (1-10 scale)</div>
          <div class="grid" style="grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
            <label>
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                <span>Geography</span>
                <span class="badge teal" style="font-size: 10px; padding: 2px 6px;">30%</span>
              </div>
              <input name="geography_risk" type="number" min="1" max="10" step="0.1" value="1" />
            </label>
            <label>
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                <span>Product</span>
                <span class="badge teal" style="font-size: 10px; padding: 2px 6px;">20%</span>
              </div>
              <input name="product_risk" type="number" min="1" max="10" step="0.1" value="1" />
            </label>
            <label>
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                <span>Behavior</span>
                <span class="badge teal" style="font-size: 10px; padding: 2px 6px;">30%</span>
              </div>
              <input name="behavior_risk" type="number" min="1" max="10" step="0.1" value="1" />
            </label>
          </div>
          <div style="display: flex; gap: 12px; margin-top: 8px;">
            <label class="checkbox" style="flex: 1;">
              <input name="pep_flag" type="checkbox" />
              <span>PEP <span style="color: var(--amber); font-size: 11px;">(+10)</span></span>
            </label>
            <label class="checkbox" style="flex: 1;">
              <input name="sanctions_hit" type="checkbox" />
              <span>Sanctions <span style="color: var(--red); font-size: 11px;">(+15)</span></span>
            </label>
          </div>
          <div id="riskPreview" style="margin-top: 12px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px; display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span style="font-size: 12px; color: var(--muted);">Calculated Risk Score (1-100):</span>
              <div style="display: flex; gap: 8px; align-items: center;">
                <span id="riskScorePreview" style="font-size: 18px; font-weight: 700;">10.00</span>
                <span id="riskLevelPreview" class="badge">low</span>
              </div>
            </div>
          </div>
        </div>

        <label>Manual Risk Override <input name="risk_override" placeholder="e.g. elevate to high" /></label>
        <button class="btn primary" type="submit">Create</button>
      </form>
    </div>
  </div>

  <div id="alertDefModal" class="modal hidden">
    <div class="modal-content" style="width: min(560px, 90vw)">
      <div class="modal-head">
        <h3 id="alertDefModalTitle">Create Alert Rule</h3>
        <button id="closeAlertDefModal" class="btn icon">&times;</button>
      </div>
      <form id="alertDefForm" class="form">
        <input type="hidden" name="definition_id" />
        <label>Code <input name="code" required placeholder="e.g. VELOCITY_CHECK_1H" /></label>
        <label>Name <input name="name" required placeholder="e.g. Velocity ‚â• EUR 5k in 1h" /></label>
        <label>Description <textarea name="description" rows="2" style="resize: vertical; font-family: inherit;"></textarea></label>
        <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 12px;">
          <label>Category <select name="category" required>
            <option value="transaction_monitoring">Transaction Monitoring</option>
            <option value="kyc">KYC</option>
            <option value="sanctions">Sanctions</option>
          </select></label>
          <label>Severity <select name="severity" required>
            <option value="low">Low</option>
            <option value="medium" selected>Medium</option>
            <option value="high">High</option>
            <option value="critical">Critical</option>
          </select></label>
        </div>
        <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 12px;">
          <label>Threshold amount <input name="threshold_amount" type="number" step="0.01" placeholder="e.g. 5000" /></label>
          <label>Window (minutes) <input name="window_minutes" type="number" placeholder="e.g. 60" /></label>
        </div>
        <label>Channels (comma-separated) <input name="channels" placeholder="e.g. cash, wire, transfer" /></label>
        <label>Country scope (comma-separated) <input name="country_scope" placeholder="e.g. RO, BG, HU" /></label>
        <label>Direction <select name="direction">
          <option value="">Any</option>
          <option value="domestic">Domestic</option>
          <option value="cross_border">Cross-border</option>
          <option value="remittance">Remittance</option>
        </select></label>
        <label class="checkbox"><input name="enabled" type="checkbox" checked /> Enabled</label>
        <button class="btn primary" type="submit">Save</button>
      </form>
    </div>
  </div>

  <div id="workflowModal" class="modal hidden">
    <div class="modal-content" style="width: min(520px, 90vw)">
      <div class="modal-head">
        <h3 id="workflowModalTitle">Start Workflow</h3>
        <button id="closeWorkflowModal" class="btn icon">&times;</button>
      </div>
      <form id="workflowForm" class="form">
        <input type="hidden" id="workflowType" name="workflow_type" />

        <div id="workflowDescription" style="background: rgba(91,224,179,0.08); border: 1px solid var(--border); border-radius: 10px; padding: 12px; margin-bottom: 16px;">
          <p id="workflowDescText" class="muted" style="margin: 0; font-size: 13px;"></p>
        </div>

        <label>
          Customer
          <select id="workflowCustomerId" name="customer_id" required>
            <option value="">Select a customer...</option>
          </select>
        </label>

        <div id="kycRefreshParams" style="display: none;">
          <label>
            Days Before Expiry
            <input name="days_before" type="number" min="1" max="730" value="365" />
            <span style="font-size: 12px; color: var(--muted); display: block; margin-top: 4px;">
              Check for documents expiring within this many days (default: 1 year)
            </span>
          </label>
        </div>

        <div id="sanctionsParams" style="display: none;">
          <label class="checkbox">
            <input name="hit_detected" type="checkbox" />
            <span>Simulate Sanctions Hit (for testing)</span>
          </label>
          <p style="font-size: 12px; color: var(--muted); margin: 8px 0 0 28px;">
            When checked, the workflow will create an alert as if a sanctions match was found
          </p>
        </div>

        <div style="display: flex; gap: 10px; margin-top: 16px;">
          <button class="btn primary" type="submit" style="flex: 1;">Start Execution</button>
          <button class="btn outline" type="button" onclick="toggleModal(false, 'workflowModal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Slide-out Detail Panel -->
  <div id="detailPanelOverlay" class="panel-overlay hidden" onclick="closeDetailPanel()"></div>
  <div id="detailPanel" class="slide-panel hidden">
    <div class="panel-header">
      <h2 id="panelTitle">Alert Details</h2>
    </div>
    <div id="panelContent" class="panel-body">
      <!-- Dynamic content loaded here -->
    </div>
    <div id="panelActions" class="panel-footer">
      <!-- Back and Edit buttons will be added here -->
    </div>
  </div>

  <!-- Alert Assign Modal -->
  <div id="alertAssignModal" class="modal hidden">
    <div class="modal-content" style="max-width: 400px;">
      <h3>Assign Alert</h3>
      <p class="muted" style="margin-bottom: 16px;">Select a user to assign this alert to</p>
      <form id="alertAssignForm" onsubmit="submitAlertAssign(event)">
        <input type="hidden" id="alertAssignId" />
        <label>
          Assign to
          <select id="alertAssignTo" required>
            <option value="">Select user...</option>
          </select>
        </label>
        <div style="display: flex; gap: 10px; margin-top: 16px;">
          <button class="btn primary" type="submit" style="flex: 1;">Assign</button>
          <button class="btn outline" type="button" onclick="closeAlertAssignModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Alert Escalate Modal -->
  <div id="alertEscalateModal" class="modal hidden">
    <div class="modal-content" style="max-width: 400px;">
      <h3>Escalate Alert</h3>
      <p class="muted" style="margin-bottom: 16px;">Escalate this alert to a senior analyst or manager</p>
      <form id="alertEscalateForm" onsubmit="submitAlertEscalate(event)">
        <input type="hidden" id="alertEscalateId" />
        <label>
          Escalate to
          <select id="alertEscalateTo" required>
            <option value="">Select user...</option>
          </select>
        </label>
        <label style="margin-top: 12px;">
          Reason
          <textarea id="alertEscalateReason" rows="3" required placeholder="Describe why this needs escalation..."></textarea>
        </label>
        <div style="display: flex; gap: 10px; margin-top: 16px;">
          <button class="btn primary" type="submit" style="flex: 1;">Escalate</button>
          <button class="btn outline" type="button" onclick="closeAlertEscalateModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Alert Resolve Modal -->
  <div id="alertResolveModal" class="modal hidden">
    <div class="modal-content" style="max-width: 450px;">
      <h3>Resolve Alert</h3>
      <p class="muted" style="margin-bottom: 16px;">Confirm the resolution of this alert</p>
      <form id="alertResolveForm" onsubmit="submitAlertResolve(event)">
        <input type="hidden" id="alertResolveId" />
        <label>
          Resolution Type
          <select id="alertResolutionType" required onchange="toggleResolutionNotes()">
            <option value="">Select resolution type...</option>
            <option value="confirmed_suspicious">Confirmed Suspicious</option>
            <option value="false_positive">False Positive</option>
            <option value="not_suspicious">Not Suspicious</option>
            <option value="duplicate">Duplicate</option>
            <option value="other">Other</option>
          </select>
        </label>
        <label style="margin-top: 12px;">
          Resolution Notes
          <textarea id="alertResolutionNotes" rows="3" placeholder="Add notes about the resolution..."></textarea>
        </label>
        <div style="display: flex; gap: 10px; margin-top: 16px;">
          <button class="btn primary" type="submit" style="flex: 1;">Resolve</button>
          <button class="btn outline" type="button" onclick="closeAlertResolveModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Alert Hold Modal -->
  <div id="alertHoldModal" class="modal hidden">
    <div class="modal-content" style="max-width: 400px;">
      <h3>Put Alert on Hold</h3>
      <p class="muted" style="margin-bottom: 16px;">Put this alert on hold while waiting for additional information</p>
      <form id="alertHoldForm" onsubmit="submitAlertHold(event)">
        <input type="hidden" id="alertHoldId" />
        <label>
          Reason (optional)
          <textarea id="alertHoldReason" rows="3" placeholder="Why is this being put on hold?"></textarea>
        </label>
        <div style="display: flex; gap: 10px; margin-top: 16px;">
          <button class="btn primary" type="submit" style="flex: 1;">Put on Hold</button>
          <button class="btn outline" type="button" onclick="closeAlertHoldModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Alert Add Note Modal -->
  <div id="alertNoteModal" class="modal hidden">
    <div class="modal-content" style="max-width: 450px;">
      <h3>Add Note</h3>
      <form id="alertNoteForm" onsubmit="submitAlertNote(event)">
        <input type="hidden" id="alertNoteAlertId" />
        <label>
          Note
          <textarea id="alertNoteContent" rows="4" required placeholder="Enter your note..."></textarea>
        </label>
        <div style="display: flex; gap: 10px; margin-top: 16px;">
          <button class="btn primary" type="submit" style="flex: 1;">Add Note</button>
          <button class="btn outline" type="button" onclick="closeAlertNoteModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    window.API_BASE = window.API_BASE || "http://localhost:8000";
  </script>
  <script src="./app.js" type="module"></script>
</body>
</html>
